@page "/register"
@using FileManager.Client.Services
@using FileManager.Shared.DTOs
@inject ApiService Api
@inject NavigationManager Navigation

<style>
    .auth-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .auth-card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 100%; max-width: 400px; }
    .auth-icon { width: 80px; height: 80px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 40px; }
    .auth-title { margin: 0; font-size: 28px; color: #2d3748; text-align: center; }
    .auth-subtitle { color: #718096; margin-top: 8px; text-align: center; }
    .error { background: #fed7d7; color: #c53030; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; color: #4a5568; font-weight: 600; margin-bottom: 8px; font-size: 14px; }
    .form-input { width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px; }
    .form-input:focus { outline: none; border-color: #f5576c; }
    .btn-submit { width: 100%; padding: 14px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(240, 147, 251, 0.4); }
    .btn-submit:disabled { cursor: not-allowed; opacity: 0.6; }
    .auth-footer { margin-top: 24px; text-align: center; color: #718096; font-size: 14px; }
    .auth-link { background: none; border: none; color: #f5576c; cursor: pointer; font-weight: 600; }
</style>

<div class="auth-container">
    <div class="auth-card">
        <div class="auth-icon">âœ¨</div>
        <h1 class="auth-title">Create Account</h1>
        <p class="auth-subtitle">Join us today</p>
        
        @if (!string.IsNullOrEmpty(error))
        {
            <div class="error">@error</div>
        }

        <EditForm Model="@registerRequest" OnValidSubmit="HandleRegister">
            <DataAnnotationsValidator />
            
            <div class="form-group">
                <label class="form-label">Username</label>
                <InputText @bind-Value="registerRequest.Username" 
                           placeholder="Choose a username" 
                           class="form-input"
                           disabled="@loading" />
                <ValidationMessage For="@(() => registerRequest.Username)" />
            </div>

            <div class="form-group">
                <label class="form-label">Email</label>
                <InputText @bind-Value="registerRequest.Email" 
                           placeholder="your@email.com" 
                           class="form-input"
                           disabled="@loading" />
                <ValidationMessage For="@(() => registerRequest.Email)" />
            </div>

            <div class="form-group">
                <label class="form-label">Password</label>
                <InputText type="password" 
                           @bind-Value="registerRequest.Password" 
                           placeholder="Create a strong password" 
                           class="form-input"
                           disabled="@loading" />
                <ValidationMessage For="@(() => registerRequest.Password)" />
            </div>

            <button type="submit" class="btn-submit" disabled="@loading">
                @(loading ? "Creating account..." : "Create Account")
            </button>
        </EditForm>

        <div class="auth-footer">
            Already have an account? 
            <button @onclick="@(() => Navigation.NavigateTo("/login"))" class="auth-link">
                Sign in
            </button>
        </div>
    </div>
</div>

@code {
    private RegisterRequest registerRequest = new();
    private string error = "";
    private bool loading = false;

    private async Task HandleRegister()
    {
        error = "";
        loading = true;

        try
        {
            await Api.RegisterAsync(registerRequest);
            Navigation.NavigateTo("/login");
        }
        catch
        {
            error = "Registration failed";
        }
        finally
        {
            loading = false;
        }
    }
}